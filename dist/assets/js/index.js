"use strict";var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],a=!0,n=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var converter=new showdown.Converter({simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,strikethrough:!0,tables:!0,tasklist:!0,ghCodeBlocks:!0,smoothLivePreview:!0,smartIndentationFix:!0,simpleLineBreaks:!0,openLinksInNewWindow:!0,emoji:!0});converter.setFlavor("github");var renderBox=document.querySelector(".markdown-body"),textarea=document.querySelector("textarea"),rawText=localStorage.getItem("rawText"),toggleDisplay=function(e){e?(textarea.classList.remove("nodisplay"),renderBox.classList.add("nodisplay")):(textarea.classList.add("nodisplay"),renderBox.classList.remove("nodisplay"))},moveCaretToStart=function(){if("number"==typeof textarea.selectionStart)textarea.selectionStart=textarea.selectionEnd=0;else if(void 0!==textarea.createTextRange){textarea.focus();var e=textarea.createTextRange();e.collapse(!0),e.select()}},edit=function(){toggleDisplay(1),moveCaretToStart(),textarea.focus(),textarea.scrollTop=0},save=function(){toggleDisplay(0);var e=textarea.value,t=converter.makeHtml(e);renderBox.innerHTML=t,t!==converter.makeHtml(rawText)&&(localStorage.setItem("rawText",e),localStorage.setItem("lastEdited",new Date),rawText=e,setHistory())},getHistory=function(){var e=localStorage.getItem("history");return null===e?[]:JSON.parse(e)},setHistory=function(){var e=getHistory(),t={date:new Date,text:rawText};e.unshift(t),localStorage.setItem("history",JSON.stringify(e))},displayMarkdown=function(e){var t=atob(e.getAttribute("data-text")),r=e.children[1],a=e.children[2];r.classList.remove("nodisplay"),a.classList.add("nodisplay"),r.innerHTML=converter.makeHtml(t)},displayTextarea=function(e){var t=atob(e.getAttribute("data-text")),r=e.children[1],a=e.children[2];r.classList.add("nodisplay"),a.classList.remove("nodisplay"),a.innerHTML=t},populateHistoryHtml=function e(){var t="",r=getHistory(),a=r.length;r.map(function(e,r){var n=new Date(Date.parse(e.date)),o=n.toDateString().slice(4)+", "+n.toTimeString().slice(0,8),i=btoa(e.text);t+="<div class='item' data-text='"+i+"'>\n                <div class='label flex'>\n                    <div>\n                        <p class='id'>#"+(a-r)+"</p>\n                        <p class='date'>"+o+"</p>\n                    </div>\n                    <div class='noselect'>\n                        <div class='button'>\n                            <img class='nodrag' src='/assets/svg/bin.svg'/>\n                        </div>\n                        <div class='button'>\n                            <img class='nodrag' src='/assets/svg/view.svg'/>\n                        </div>\n                    </div>\n                </div>\n                <div class='markdown-body'></div>\n                <textarea class='nodisplay' readonly></textarea>\n            </div>"}),document.querySelector("section.history .list").innerHTML=t,[].concat(_toConsumableArray(document.querySelectorAll(".item"))).reverse().map(function(t,n){displayMarkdown(t);var o=_slicedToArray(t.children[0].children[1].children,2),i=o[0],s=o[1];i.removeEventListener("click",l),s.removeEventListener("click",c);var l=i.addEventListener("click",function(){r.splice(a-n-1,1),localStorage.setItem("history",JSON.stringify(r)),e()}),c=s.addEventListener("click",function(){t.children[2].classList.contains("nodisplay")?displayTextarea(t):displayMarkdown(t)})})};textarea.value=rawText,save(),document.querySelector("#edit").addEventListener("click",function(){edit()},!1),document.querySelector("#save").addEventListener("click",function(){save()},!1),document.querySelector("#lastEdited").addEventListener("click",function(){populateHistoryHtml(),document.querySelector("section.history").classList.remove("nodisplay")},!1),document.querySelector("#close").addEventListener("click",function(){document.querySelector("section.history").classList.add("nodisplay")},!1),document.addEventListener("keydown",function(e){(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?83===e.keyCode?(e.preventDefault(),save()):88===e.keyCode&&(e.preventDefault(),edit()):27===e.keyCode&&document.querySelector("section.history").classList.add("nodisplay")},!1);var timeDisplay=function(){setInterval(function(){var e=new Date,t=(e.getDate()<10?"0"+e.getDate():e.getDate())+"/"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"/"+(e.getFullYear()<10?"0"+e.getFullYear():e.getFullYear())+" - "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());document.querySelector("#time").innerHTML=t},1e3)};timeDisplay(),setInterval(function(){document.querySelector("#lastEdited").innerHTML="Last edited: "+timeago().format(Date.parse(localStorage.getItem("lastEdited")))},1e3),POWERMODE.shake=!1,POWERMODE.colorful=!0,textarea.addEventListener("input",POWERMODE);