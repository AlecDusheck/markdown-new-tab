"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}var converter=new showdown.Converter({simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,strikethrough:!0,tables:!0,tasklist:!0,ghCodeBlocks:!0,smoothLivePreview:!0,smartIndentationFix:!0,simpleLineBreaks:!0,openLinksInNewWindow:!0,emoji:!0});converter.setFlavor("github");var renderBox=document.querySelector(".markdown-body"),textarea=document.querySelector("textarea"),rawText=localStorage.getItem("rawText"),toggleDisplay=function(e){e?(textarea.classList.remove("nodisplay"),renderBox.classList.add("nodisplay")):(textarea.classList.add("nodisplay"),renderBox.classList.remove("nodisplay"))},moveCaretToStart=function(){if("number"==typeof textarea.selectionStart)textarea.selectionStart=textarea.selectionEnd=0;else if(void 0!==textarea.createTextRange){textarea.focus();var e=textarea.createTextRange();e.collapse(!0),e.select()}},edit=function(){toggleDisplay(1),moveCaretToStart(),textarea.focus(),textarea.scrollTop=0},save=function(){toggleDisplay(0);var e=textarea.value,t=converter.makeHtml(e);renderBox.innerHTML=t,t!==converter.makeHtml(rawText)&&(localStorage.setItem("rawText",e),localStorage.setItem("lastEdited",new Date),rawText=e,setHistory())},getHistory=function(){var e=localStorage.getItem("history");return null===e?[]:JSON.parse(e)},setHistory=function(){var e=getHistory(),t={id:e.length,date:new Date,text:rawText};e.unshift(t),localStorage.setItem("history",JSON.stringify(e))},displayMarkdown=function(e){var t=atob(e.getAttribute("data-text")),a=e.children[1],r=e.children[2];a.classList.remove("nodisplay"),r.classList.add("nodisplay"),a.innerHTML=converter.makeHtml(t)},displayTextarea=function(e){var t=atob(e.getAttribute("data-text")),a=e.children[1],r=e.children[2];a.classList.add("nodisplay"),r.classList.remove("nodisplay"),r.innerHTML=t},populateHistoryHtml=function(){var e="";getHistory().map(function(t){var a=+t.id+1,r=new Date(Date.parse(t.date)),n=r.toDateString().slice(4)+", "+r.toTimeString().slice(0,8),o=btoa(t.text);e+="<div class='item' data-text='"+o+"'><div class='label flex'><div><p class='id'>#"+a+"</p><p class='date'>"+n+"</p></div><div class='button'><img src='/assets/svg/view.svg'/></div></div><div class='markdown-body'></div><textarea class='nodisplay' readonly></textarea></div>"}),document.querySelector("section.history .list").innerHTML=e,[].concat(_toConsumableArray(document.querySelectorAll(".item"))).reverse().map(function(e){displayMarkdown(e),e.children[0].children[1].removeEventListener("click",t);var t=e.children[0].children[1].addEventListener("click",function(){e.children[2].classList.contains("nodisplay")?displayTextarea(e):displayMarkdown(e)})})};textarea.value=rawText,save(),document.querySelector("#edit").addEventListener("click",function(){edit()},!1),document.querySelector("#save").addEventListener("click",function(){save()},!1),document.querySelector("#lastEdited").addEventListener("click",function(){populateHistoryHtml(),document.querySelector("section.history").classList.remove("nodisplay")},!1),document.querySelector("#close").addEventListener("click",function(){document.querySelector("section.history").classList.add("nodisplay")},!1),document.addEventListener("keydown",function(e){(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?83===e.keyCode?(e.preventDefault(),save()):88===e.keyCode&&(e.preventDefault(),edit()):27===e.keyCode&&document.querySelector("section.history").classList.add("nodisplay")},!1);var timeDisplay=function(){setInterval(function(){var e=new Date,t=(e.getDate()<10?"0"+e.getDate():e.getDate())+"/"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"/"+(e.getFullYear()<10?"0"+e.getFullYear():e.getFullYear())+" - "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds());document.querySelector("#time").innerHTML=t},1e3)};timeDisplay(),setInterval(function(){document.querySelector("#lastEdited").innerHTML="Last edited: "+timeago().format(Date.parse(localStorage.getItem("lastEdited")))},1e3),POWERMODE.shake=!1,POWERMODE.colorful=!0,textarea.addEventListener("input",POWERMODE);